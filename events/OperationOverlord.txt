#################################################################################################
#
# Marneman's Operation Overlord (D-Day) Events
#
# In the old days of ICE, D-Day events were basically implemented as a simple
# series of OOB files that were "dropped" into Normandy.  This series of
# events is meant to be a replacement for that. I want Operation Overlord to
# be a truly "dynamic" part of the game, and a simple scripted event.
#
# 
# 
#################################################################################################
#
# TODO - other events to deprecate or merge in with this one: SHAEF creation, Atlantic Wall?
#
#################################################################################################

#################################################################################################
#
# Initiation event - appointment of COSSAC
#
# British Lt-General Frederick E. Morgan apointed as Chief of Staff to Supreme Allied
# Commander (COSSAC) in March, 1943.  This began the planning process for Operation Overlord.
#
#################################################################################################

country_event = {
	id = 999800
	fire_only_once = yes
	trigger = {
		ai = yes
		date = 1943.03.01
		not = { has_global_flag = overlord_cossac_appointed }
		not = { has_country_flag = invasion_choice_no }
		# England must still be alive! Otherwise, we are going to do a different event chain to rescue ENG
		exists = ENG
		1964 = { controlled_by = ENG } # London
	}

	title = "EVTNAMEMARNE0089"
	desc = "EVTDESCMARNE0089"
	picture = "overlord-morgan"

	option = {
		name = "Ok."
		set_global_flag = overlord_cossac_appointed
	}
}

#################################################################################################
#
# Next, the allied player/AI decides what course of action they want to take.
# Chiefly, do they want to invest the supplies/money into planning the
# invasion of Axis-controlled Europe at all.
#
#################################################################################################

country_event = {
	id = 999801

	fire_only_once = yes 

	#major = yes # Just for debugging
	
	trigger = {
		tag = USA
		USA = { ai = yes }
		
		# Make sure they have enough supplies/money to pay for the planning process
		supplies = 2500
		money = 2500

		# This is the historical date during which the planning phase started
		date = 1943.06.01
		
		# England must still be alive! Otherwise, we are going to do a different event chain to rescue ENG
		exists = ENG
		1964 = { controlled_by = ENG } # London
	}

	# Kicks off on the date above (the modifier ensures the MTTH fires appropriately)
	mean_time_to_happen = {
		days = 1
		modifier = { factor = 9999999 not = { has_global_flag = overlord_cossac_appointed } }
	}
	
	title = "EVTNAMEMARNE0090"
	desc = "EVTDESCMARNE0090"
	picture = "overlord-decide"

	# It costs a little money/supplies to start the planning process, but the malus for opting
	# into Overlord is significant, as seen in the effect modifiers for the OverlordBuildup
	# effect (a huge reduction in IC/IC Efficiency for the duration) - there are some bonuses
	# conferred as well (for recruiting, etc.) but the main thing is that the units shouldn't
	# be "free" to the player.

	option = {
		name = "EVTOPTAMARNE0090"
		ai_chance = { factor = 100 }
		set_global_flag = overlord_allies_yes

		money = -2500
		supplies = -2500
		
		
		any_country = {
			#limit = { ai = no }
			limit = {
				tag = USA
			}
			add_country_modifier = {
				name = "OverlordBuildup"
				duration = 365
			}
		}

		any_country = {
			#limit = { ai = no }
			limit = {
				tag = ENG
			}
			add_country_modifier = {
				name = "OverlordBuildup"
				duration = 365
			}
		}		
	}

	# The player has a chance to opt out of this altogether should they choose
	option = {
		name = "EVTOPTBMARNE0090"
		ai_chance = { factor = 0 }
		set_global_flag = overlord_allies_no
	}
}

#################################################################################################
#
# Next, the allied player/AI decides what course of action they want to take with respect to
# Naval forces.  They can choose to invest more IC into the buildup of a naval task force, or
# they can choose to build/use their own naval forces in their own way (i.e. opt out of this
# part).  Opting into this will introduce an additional malus for the duration of the buildup.
#
#################################################################################################

country_event = {
	id = 999802

	fire_only_once = yes 

	#major = yes # Just for debugging
	
	trigger = {
		tag = USA
		USA = { ai = yes }
		
		# Make sure they have enough supplies/money to pay for the planning process
		supplies = 2500
		money = 2500
		
		# England must still be alive! Otherwise, we are going to do a different event chain to rescue ENG
		exists = ENG
		1964 = { controlled_by = ENG } # London
	}

	mean_time_to_happen = {
		days = 1
		modifier = { factor = 9999999 not = { has_global_flag = overlord_allies_yes } }
	}
	
	title = "EVTNAMEMARNE0107"
	desc = "EVTDESCMARNE0107"
	picture = "overlord-allies-naval-decide"

	option = {
		name = "EVTOPTAMARNE0107"
		ai_chance = { factor = 100 }
		set_global_flag = overlord_allies_naval_yes

		money = -2500
		supplies = -2500
		
		# We set this effect for 12 months (365 days) to provide good date range coverage, but it is removed
		# once the invasion starts.  *Both* USA and ENG get this malus.  Yes, the buildup to D-Day was really
		# that big.

		USA = {
			add_country_modifier = {
				name = "OverlordBuildupNaval"
				duration = 365
			}
		}

		ENG = {
			add_country_modifier = {
				name = "OverlordBuildupNaval"
				duration = 365
			}
		}		
	}

	# The player has a chance to opt out of this altogether should they choose
	option = {
		name = "EVTOPTBMARNE0107"
		ai_chance = { factor = 0 }
		set_global_flag = overlord_allies_no_naval
	}
}

#################################################################################################
#
# Next, the allied player is presented with their options for where they will invade.
#
#################################################################################################

country_event = {
	id = 999803

	fire_only_once = yes

	#major = yes # Just for debugging

	trigger = {
		tag = USA
		USA = { ai = yes }
		
		# England must still be alive! Otherwise, we are going to do a different event chain to rescue ENG
		exists = ENG
		1964 = { controlled_by = ENG } # London
	}

	mean_time_to_happen = {
		days = 1
		modifier = { factor = 9999999 not = { has_global_flag = overlord_allies_yes } }
	}	
	
	title = "EVTNAMEMARNE0091"
	desc = "EVTDESCMARNE0091"
	picture = "overlord-allies-location"

	option = {
		name = "EVTOPTAMARNE0091"
		set_global_flag = overlord_dest_chosen
		set_global_flag = overlord_dest_calais
		ai_chance = { factor = 30 }
	}

	option = {
		name = "EVTOPTBMARNE0091"
		set_global_flag = overlord_dest_chosen
		set_global_flag = overlord_dest_normandy
		ai_chance = { factor = 40 }
	}

	option = {
		name = "EVTOPTCMARNE0091"
		set_global_flag = overlord_dest_chosen
		set_global_flag = overlord_dest_brest
		ai_chance = { factor = 20 }
	}
	
	option = {
		name = "EVTOPTDMARNE0091"
		set_global_flag = overlord_dest_chosen
		set_global_flag = overlord_dest_bordeaux
		ai_chance = { factor = 10 }
	}

}
#################################################################################################
#
# Creation of the fictitious "1st U.S. Army Group" (FUSAG) with Patton as leader - flavor...
#
#################################################################################################

country_event = {
	id = 999811
	
	fire_only_once = yes
	
	#major = yes # Just for debugging

	trigger = {
		faction = allies
		ai = no
		has_global_flag = overlord_dest_chosen
		
		# England must still be alive! Otherwise, we are going to do a different event chain to rescue ENG
		exists = ENG
		1964 = { controlled_by = ENG } # London
	}

	mean_time_to_happen = {
		days = 3
		modifier = { factor = 9999999 not = { has_global_flag = overlord_reinforce_method_chosen } }
	}

	title = "EVTNAMEMARNE0096"
	desc = "EVTDESCMARNE0096"
	picture = "overlord-fusag"

	option = {
		name = "Ok."
	}
}

# Axis version of FUSAG event
country_event = {
	id = 999812
	
	fire_only_once = yes
	
	#major = yes # Just for debugging

	trigger = {
		tag = GER
		ai = no
		has_global_flag = overlord_dest_chosen
		
		# England must still be alive! Otherwise, we are going to do a different event chain to rescue ENG
		exists = ENG
		1964 = { controlled_by = ENG } # London
	}

	mean_time_to_happen = {
		days = 3
		modifier = { factor = 9999999 not = { has_global_flag = overlord_reinforce_method_chosen } }
	}

	title = "EVTNAMEMARNE0096b"
	desc = "EVTDESCMARNE0096b"
	picture = "overlord-fusag"

	option = {
		name = "Ok."
	}
}
#################################################################################################
#
# Intel cache gathered by covert operatives
#
# There is a *VERY* small chance that the Axis will discover the actual Allied
# invasion plans. If this happens, then the GER AI will automatically change
# where it plans on defending.
#
#################################################################################################

country_event = {
	id = 999818

	#major = yes # Just for debugging
	
	# Fires for GER every 45 days or so from the time Overlord is being planned, to
	# the time it is underway
	trigger = {
		tag = GER
		war_with = USA
		has_global_flag = overlord_allies_yes
		NOT = { has_global_flag = overlord_underway }
		NOT = { has_global_flag = overlord_plans_discovered }
		
		# England must still be alive! Otherwise, we are going to do a different event chain to rescue ENG
		exists = ENG
		1964 = { controlled_by = ENG } # London
	}

	# This fires every 45 days or so
	mean_time_to_happen = {
		days = 45
	}

	title = "EVTNAMEMARNE0102"
	desc = "EVTDESCMARNE0102"
	picture = "overlord-intel-cache"

	option = {
		name = "EVTOPTAMARNE0102"

		random_list = {
			2 = { 
					Operation_Overlord_Fake_Region = {	
						limit = { has_global_flag = overlord_dest_calais }
						GER = { country_event = 999819 }
						set_global_flag = overlord_defend_calais
						clr_global_flag = overlord_defend_normandy
						clr_global_flag = overlord_defend_brest
						clr_global_flag = overlord_defend_bordeaux
					}
					
					Operation_Overlord_Fake_Region = {	
						limit = { has_global_flag = overlord_dest_normandy }
						GER = { country_event = 999820 }
						clr_global_flag = overlord_defend_calais
						set_global_flag = overlord_defend_normandy
						clr_global_flag = overlord_defend_brest
						clr_global_flag = overlord_defend_bordeaux
					}

					Operation_Overlord_Fake_Region = {	
						limit = { has_global_flag = overlord_dest_brest }
						GER = { country_event = 999821 }
						clr_global_flag = overlord_defend_calais
						clr_global_flag = overlord_defend_normandy
						set_global_flag = overlord_defend_brest
						clr_global_flag = overlord_defend_bordeaux
					}

					Operation_Overlord_Fake_Region = {	
						limit = { has_global_flag = overlord_dest_bordeaux }
						GER = { country_event = 999822 }
						clr_global_flag = overlord_defend_calais
						clr_global_flag = overlord_defend_normandy
						clr_global_flag = overlord_defend_brest
						set_global_flag = overlord_defend_bordeaux
					}
					
					set_global_flag = overlord_plans_discovered
				}
				
			98 = {
				set_global_flag = overlord_plans_still_secret
			}
		}
	}
}

# These events are chained to the one above - these get called if the invasion
# plans were actually discovered!

country_event = {
	id = 999819

	is_triggered_only = yes
	
	#major = yes # Just for debugging

	title = "Allied Invasion will target the Pas-de-Calais!"
	desc = ""
	picture = "overlord-stolen-plans-calais"

	option = {
		name = "Perfect!"
	}
}

country_event = {
	id = 999820

	is_triggered_only = yes
	
	#major = yes # Just for debugging

	title = "Allied Invasion to arrive via Normandy!"
	desc = ""
	picture = "overlord-stolen-plans-normandy"

	option = {
		name = "Perfect!"
	}
}

country_event = {
	id = 999821

	is_triggered_only = yes
	
	#major = yes # Just for debugging

	title = "Allied Nations plan to invade through Brest!"
	desc = ""
	picture = "overlord-stolen-plans-brest"

	option = {
		name = "Perfect!"
	}
}

country_event = {
	id = 999822

	is_triggered_only = yes
	
	#major = yes # Just for debugging

	title = "Allies plan to invade through Bordeaux!"
	desc = ""
	picture = "overlord-stolen-plans-bordeaux"

	option = {
		name = "Perfect!"
	}
}

#################################################################################################
#
# The Calm Before the Storm ... this event needs to be the last in the chain prior to the start
# of the invasion (except for the one above).  This lets the engine know that everything is ready to go
# (via the overlord_ready flag).
#
#################################################################################################

country_event = {
	id = 999826
	
	fire_only_once = yes
	
	#major = yes # Just for debugging
	
	trigger = {
		tag = USA
		USA = { ai = yes }
		
		year = 1944
		month = 5
		faction = allies
		
		# England must still be alive! Otherwise, we are going to do a different event chain to rescue ENG
		exists = ENG
		1964 = { controlled_by = ENG } # London
	}

	mean_time_to_happen =  {
		days = 1
		modifier = { factor = 9999999 not = { has_global_flag = overlord_allies_yes } }
	}
	
	title = "EVTNAMEMARNE0103"
	desc = "EVTDESCMARNE0103"
	picture = "overlord-ready"
	
	option = {
		name = "We are ready."
		set_global_flag = overlord_ready
		ai_chance = { factor = 100 }
	}
}

#################################################################################################
#
# D-Day has arrived!
# 
# TODO: Tie this to a decision to launch? That would help the player coordinate his
# naval and other forces better.
#
#################################################################################################

country_event = {

	id = 999828
	
	fire_only_once = yes
	
	
	trigger = {
		# Triggers for the USA or ENG player only, or the USA/AI if the AI is playing both ENG/USA
		tag = USA
		USA = { ai = yes }
		war_with = GER
		has_global_flag = overlord_ready
		
		2250 = { controller = { faction = allies } } # Plymouth
		2078 = { controller = { faction = allies } } # Portsmouth (ENG) - Fixed from Portsmouth, USA
		2613 = { controller = { faction = axis } } #Paris
		2311 = { controller = { faction = axis } } #Bruxelles
		1910 = { controller = { faction = axis } } #Amsterdam
		2422 = { controller = { faction = axis } } #Cherbourg
		
		OR = {
			AND = {
				GER = {	northern_france_region	= { not = {units_in_province = 100 } }}
				GER = {	western_france_region	= { not = {units_in_province = 100 } }}
				GER = {	southern_france_region	= { not = {units_in_province = 100 } }}
				GER = { ai = yes }
			}
			GER = { ai = no }
		}
		
		# England must still be alive! Otherwise, we are going to do a different event chain to rescue ENG
		exists = ENG
		1964 = { controlled_by = ENG } # London
	}
	allow = {
		date = 1944.05.05
	}
	
	mean_time_to_happen =  {
		days = 40
	}
	
	title = "EVTNAMEMARNE0105"
	desc = "EVTDESCMARNE0105"
	picture = "overlord-start"

	option = {
		name = "EVTOPTAMARNE0105"
		ai_chance = { factor = 100 }
		set_global_flag = overlord_underway
		
		USA = { add_country_modifier = { name = "DDAY_ONE" duration = 14 } }
		USA = { add_country_modifier = { name = "DDAY_TWO" duration = 7 } }
		USA = { add_country_modifier = { name = "DDAY_THREE" duration = 5 } }
		USA = { add_country_modifier = { name = "DDAY_FOUR" duration = 4 } }
		ENG = { add_country_modifier = { name = "DDAY_ONE" duration = 14 } }
		ENG = { add_country_modifier = { name = "DDAY_TWO" duration = 7 } }
		CAN = { add_country_modifier = { name = "DDAY_ONE" duration = 14 } }
		
		GER = { add_country_modifier = { name = "DDAY_shock" duration = 8 } }
		ITA = { add_country_modifier = { name = "DDAY_shock" duration = 8 } }

		USA = { remove_country_modifier = OverlordBuildup }
		ENG = { remove_country_modifier = OverlordBuildup }
		
		# To load OOBs somewhat conditionally, we wrap it in a fake region along with a limit check against our global flags.
		# But you need the region there to trigger the limit lol. The region has to be defined though, so I just pointed it to Paris ...
		# Lol doesn't matter, just has to be valid.
		
		######################################################################################################
		# Pas-de-Calais
		######################################################################################################
	
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_dest_calais }
			USA = { load_oob = DDAYCalais.txt }
		}
		
		######################################################################################################
		# Normandy Coast
		######################################################################################################

		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_dest_normandy }
			USA = { load_oob = DDAYNormandy.txt }
		}

		######################################################################################################
		# Brest / Quimper / Western French Coast
		######################################################################################################
		
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_dest_brest }
			USA = { load_oob = DDAYBrest.txt }
		}

		######################################################################################################
		# Bordeaux / Dax / Southwestern French Coast
		######################################################################################################

		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_dest_bordeaux }
			USA = { load_oob = DDAYBordeaux.txt }
		}
	}
}

#################################################################################################
#
# Allied reinforcement week 1
#
#################################################################################################
country_event = {
	id = 999830
	
	fire_only_once = yes
	
	#major = yes # Just for debugging
	
	trigger = {
		tag = USA
		USA = { ai = yes }
		year = 1944
		has_global_flag = overlord_underway
		or = {
			2194 = { controller = { faction = allies } } # Calais
			2422 = { controller = { faction = allies } } # Cherbourg
			2605 = { controller = { faction = allies } } # Brest
			3479 = { controller = { faction = allies } } # Bordeaux
		}
	}
	
	mean_time_to_happen = {
		days = 1
	}

	title = "EVTNAMEMARNE0106"
	desc = "EVTDESCMARNE0106"
	picture = "overlord-reinforcements"
	
	option = {
		name = "EVTOPTAMARNE0106"
		ai_chance = { factor = 100 }

		set_country_flag = overlord_reinforcement_complete_week1
		
		######################################################################################################
		# Pas-de-Calais
		######################################################################################################

		# Supplies/fuel
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_dest_calais }
			2194 = { supplies = 20000 fuel = 20000 } # Calais
		}

		Operation_Overlord_Fake_Region = {
			limit = { has_global_flag = overlord_dest_calais }
			USA = { load_oob = DDay_Reinforcements_week1Calais.txt }
		}

		######################################################################################################
		# Normandy Coast
		######################################################################################################

		# Supplies
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_reinforce_dest_normandy }
			2422 = { supplies = 20000 fuel = 20000 } # Cherbourg
		}
		
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_reinforce_dest_normandy }
			USA = { load_oob = DDay_Reinforcements_week1Normandy.txt }
		}

		######################################################################################################
		# Brest / Western French Coast
		######################################################################################################

		# Supplies
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_reinforce_dest_brest }
			2605 = { supplies = 20000 fuel = 20000 } #Quimper
		}
		
		# Infantry unit types
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_reinforce_dest_brest }
			USA = { load_oob = DDay_Reinforcements_week1Brest.txt }
		}
		
		######################################################################################################
		# Bordeaux / Dax / Southwestern French Coast
		######################################################################################################		

		# Supplies
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_reinforce_dest_bordeaux }
			3747 = { supplies = 20000 fuel = 20000 } #Bordeaux
		}
		
		# Infantry unit types
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_reinforce_dest_bordeaux }
			THIS = { load_oob = DDay_Reinforcements_week1Bordeaux.txt  }
		}
	}
}

#################################################################################################
#
# Allied reinforcement wave 1
#
#################################################################################################
country_event = {
	id = 999830
	
	fire_only_once = yes
	
	#major = yes # Just for debugging
	
	trigger = {
		tag = USA
		USA = { ai = yes }
		year = 1944
		month = 7
		has_global_flag = overlord_underway
		has_country_flag = overlord_reinforcement_complete_week1
		or = {
			2194 = { controller = { faction = allies } } # Calais
			2422 = { controller = { faction = allies } } # Cherbourg
			2605 = { controller = { faction = allies } } # Brest
			3479 = { controller = { faction = allies } } # Bordeaux
		}
	}
	
	mean_time_to_happen = {
		days = 2
	}

	title = "EVTNAMEMARNE0106"
	desc = "EVTDESCMARNE0106"
	picture = "overlord-reinforcements"
	
	option = {
		name = "EVTOPTAMARNE0106"
		ai_chance = { factor = 100 }
		
		USA = { add_country_modifier = { name = "DDAY_ONE" duration = 14 } }

		set_country_flag = overlord_reinforcement_complete_wave1
		
		######################################################################################################
		# Pas-de-Calais
		######################################################################################################

		# Supplies/fuel
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_dest_calais }
			2194 = { supplies = 20000 fuel = 20000 } # Calais
		}

		Operation_Overlord_Fake_Region = {
			limit = { has_global_flag = overlord_dest_calais }
			USA = { load_oob = DDay_Reinforcements_wave1Calais.txt }
		}

		######################################################################################################
		# Normandy Coast
		######################################################################################################

		# Supplies
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_reinforce_dest_normandy }
			2422 = { supplies = 20000 fuel = 20000 } # Cherbourg
		}
		
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_reinforce_dest_normandy }
			USA = { load_oob = DDay_Reinforcements_wave1Normandy.txt }
		}

		######################################################################################################
		# Brest / Western French Coast
		######################################################################################################

		# Supplies
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_reinforce_dest_brest }
			2605 = { supplies = 20000 fuel = 20000 } #Quimper
		}
		
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_reinforce_dest_brest }
			USA = { load_oob = DDay_Reinforcements_wave1Brest.txt }
		}
		
		######################################################################################################
		# Bordeaux / Dax / Southwestern French Coast
		######################################################################################################		

		# Supplies
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_reinforce_dest_bordeaux }
			3747 = { supplies = 20000 fuel = 20000 } #Bordeaux
		}
		
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_reinforce_dest_bordeaux }
			THIS = { load_oob = DDay_Reinforcements_wave1Bordeaux.txt  }
		}
	}
}

#################################################################################################
#
# Allied reinforcement wave 2
#
#################################################################################################
country_event = {
	id = 999830
	
	fire_only_once = yes
	
	#major = yes # Just for debugging
	
	trigger = {
		tag = USA
		USA = { ai = yes }
		year = 1944
		month = 8
		has_global_flag = overlord_underway
		has_country_flag = overlord_reinforcement_complete_wave1
		or = {
			2194 = { controller = { faction = allies } } # Calais
			2422 = { controller = { faction = allies } } # Cherbourg
			2605 = { controller = { faction = allies } } # Brest
			3479 = { controller = { faction = allies } } # Bordeaux
		}
	}
	
	mean_time_to_happen = {
		days = 2
	}

	title = "EVTNAMEMARNE0106"
	desc = "EVTDESCMARNE0106"
	picture = "overlord-reinforcements"
	
	option = {
		name = "EVTOPTAMARNE0106"
		ai_chance = { factor = 100 }
		
		USA = { add_country_modifier = { name = "DDAY_ONE" duration = 14 } }

		set_country_flag = overlord_reinforcement_complete_wave2
		
		######################################################################################################
		# Pas-de-Calais
		######################################################################################################

		# Supplies/fuel
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_dest_calais }
			2194 = { supplies = 20000 fuel = 20000 } # Calais
		}

		Operation_Overlord_Fake_Region = {
			limit = { has_global_flag = overlord_dest_calais }
			USA = { load_oob = DDay_Reinforcements_wave2Calais.txt }
		}

		######################################################################################################
		# Normandy Coast
		######################################################################################################

		# Supplies
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_reinforce_dest_normandy }
			2422 = { supplies = 20000 fuel = 20000 } # Cherbourg
		}
		
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_reinforce_dest_normandy }
			USA = { load_oob = DDay_Reinforcements_wave2Normandy.txt }
		}

		######################################################################################################
		# Brest / Western French Coast
		######################################################################################################

		# Supplies
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_reinforce_dest_brest }
			2605 = { supplies = 20000 fuel = 20000 } #Quimper
		}
		
		# Infantry unit types
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_reinforce_dest_brest }
			USA = { load_oob = DDay_Reinforcements_wave2Brest.txt }
		}
		
		######################################################################################################
		# Bordeaux / Dax / Southwestern French Coast
		######################################################################################################		

		# Supplies
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_reinforce_dest_bordeaux }
			3747 = { supplies = 20000 fuel = 20000 } #Bordeaux
		}
		
		# Infantry unit types
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_reinforce_dest_bordeaux }
			THIS = { load_oob = DDay_Reinforcements_wave2Bordeaux.txt  }
		}
	}
}

#################################################################################################
#
# Allied reinforcement wave 3
#
#################################################################################################
country_event = {
	id = 999830
	
	fire_only_once = yes
	
	#major = yes # Just for debugging
	
	trigger = {
		tag = USA
		USA = { ai = yes }
		year = 1944
		month = 9
		has_global_flag = overlord_underway
		has_country_flag = overlord_reinforcement_complete_wave2
		not = { set_country_flag = overlord_reinforcement_complete_wave3 }
		or = {
			2194 = { controller = { faction = allies } } # Calais
			2422 = { controller = { faction = allies } } # Cherbourg
			2605 = { controller = { faction = allies } } # Brest
			3479 = { controller = { faction = allies } } # Bordeaux
		}
	}
	
	mean_time_to_happen = {
		days = 2
	}

	title = "EVTNAMEMARNE0106"
	desc = "EVTDESCMARNE0106"
	picture = "overlord-reinforcements"
	
	option = {
		name = "EVTOPTAMARNE0106"
		ai_chance = { factor = 100 }
		
		USA = { add_country_modifier = { name = "DDAY_ONE" duration = 14 } }

		set_country_flag = overlord_reinforcement_complete_wave3
		
		######################################################################################################
		# Pas-de-Calais
		######################################################################################################

		# Supplies/fuel
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_dest_calais }
			2194 = { supplies = 20000 fuel = 20000 } # Calais
		}

		Operation_Overlord_Fake_Region = {
			limit = { has_global_flag = overlord_dest_calais }
			USA = { load_oob = DDay_Reinforcements_wave3Calais.txt }
		}

		######################################################################################################
		# Normandy Coast
		######################################################################################################

		# Supplies
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_reinforce_dest_normandy }
			2422 = { supplies = 20000 fuel = 20000 } # Cherbourg
		}
		
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_reinforce_dest_normandy }
			USA = { load_oob = DDay_Reinforcements_wave3Normandy.txt }
		}

		######################################################################################################
		# Brest / Western French Coast
		######################################################################################################

		# Supplies
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_reinforce_dest_brest }
			2605 = { supplies = 20000 fuel = 20000 } #Quimper
		}
		
		# Infantry unit types
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_reinforce_dest_brest }
			USA = { load_oob = DDay_Reinforcements_wave3Brest.txt }
		}
		
		######################################################################################################
		# Bordeaux / Dax / Southwestern French Coast
		######################################################################################################		

		# Supplies
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_reinforce_dest_bordeaux }
			3747 = { supplies = 20000 fuel = 20000 } #Bordeaux
		}
		
		# Infantry unit types
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_reinforce_dest_bordeaux }
			THIS = { load_oob = DDay_Reinforcements_wave3Bordeaux.txt  }
		}
	}
}

#################################################################################################
# Deploy Mulberries
#################################################################################################

country_event = {
	
	id = 999824

	fire_only_once = yes

	trigger = {
		tag = USA
		USA = { ai = yes }
		
		has_global_flag = overlord_reinforcement_complete_week1
		war_with = GER
		1964 = { controller = { faction = allies } } # London
		2078 = { controller = { faction = allies } } # Portsmouth
		OR = {
			2194 = { controller = { faction = allies } } # Calais
			2195 = { controller = { faction = allies } } # Dunkurik
			2482 = { controller = { faction = allies } } # Caen (Normandy)
			2422 = { controller = { faction = allies } } # Cherbourg
			2605 = { controller = { faction = allies } } # Brest
			2737 = { controller = { faction = allies } } # Lorient
			3479 = { controller = { faction = allies } } # Bordeaux
			3613 = { controller = { faction = allies } } # Creon
		}
		
		# England must still be alive! Otherwise, we are going to do a different event chain to rescue ENG
		exists = ENG
	}
	
	mean_time_to_happen = {
		days = 3
	}
	
	title = "EVTNAME91729"
	desc = "EVTDESC91729"
	picture = "mulberries_setup"

	option = {
		name = "EVTOPTA90137"
		set_country_flag = mulberries_deployed

		Operation_Overlord_Fake_Region = {
			limit = { has_global_flag = overlord_dest_calais }
			limit = { 2308 = { controller = { faction = allies } } }
			2194 = { naval_base = 10 supplies = 20000 fuel = 20000 }
		}
		Operation_Overlord_Fake_Region = {
			limit = { has_global_flag = overlord_dest_calais }
			limit = { 2308 = { controller = { faction = allies } } }
			2195 = { naval_base = 10 supplies = 20000 fuel = 20000 }
		}
		
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_dest_normandy }
			limit = { 2482 = { controller = { faction = allies } } }
			2422 = { naval_base = 10 supplies = 20000 fuel = 20000 }
		}
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_reinforce_dest_normandy }
			limit = { 2482 = { controller = { faction = allies } } }
			2482 = { naval_base = 10 supplies = 20000 fuel = 20000 }
		}
		
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_dest_brest }
			limit = { 2671 = { controller = { faction = allies } } }
			2605 = { naval_base = 10 supplies = 20000 fuel = 20000 }
		}
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_reinforce_dest_brest }
			limit = { 2671 = { controller = { faction = allies } } }
			2737 = { naval_base = 10 supplies = 20000 fuel = 20000 }
		}

		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_dest_bordeaux }
			limit = { 3747 = { controller = { faction = allies } } }
			3749 = { naval_base = 10 supplies = 20000 fuel = 20000 }
		}
		
		Operation_Overlord_Fake_Region = {	
			limit = { has_global_flag = overlord_reinforce_dest_bordeaux }
			limit = { 3747 = { controller = { faction = allies } } }
			3613 = { naval_base = 10 supplies = 20000 fuel = 20000 }
		}			
		
		ai_chance = { factor = 100 }
	}
}

